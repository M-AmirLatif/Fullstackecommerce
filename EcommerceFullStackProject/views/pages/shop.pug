extends ../layout

block content
  section.hero
    .hero-inner(style="flex-direction: column; text-align: center;")
      .hero-left(style="flex: none;")
        h1.hero-title üõçÔ∏è Shop Our Collection
        p.hero-sub Discover thousands of products from top brands at unbeatable prices.

  .container
    .card
      h3 üîç Filter Products
      form.shop-filters(action="/shop" method="GET")
        .filter-grid
          .form-group
            label(for="category") Category
            select#category(name="category")
              option(value="") All Categories
              each c in categories
                option(value=c, selected=(c === selectedCategory))= c
          .form-group
            label(for="minPrice") Minimum Price
            input#minPrice(type="number" name="minPrice" placeholder="$0" value=minPrice || '')
          .form-group
            label(for="maxPrice") Maximum Price
            input#maxPrice(type="number" name="maxPrice" placeholder="$1000" value=maxPrice || '')
          .field-btn
            button.btn(type="submit") üîé Apply Filters
            a.btn.btn-outline(href="/shop") ‚Ü∫ Reset All

  .container
    if !products || products.length === 0
      .card
        .text-center
          p(style="font-size: 2rem; margin-bottom: 1rem;") üîç
          h3 No Products Found
          p(style="color: var(--gray);") Try adjusting your filters or browse all products.
          a.btn(href="/shop") Browse All Products
    else
      .section-head
        h2 üì¶ Results (#{products.length} product#{products.length !== 1 ? 's' : ''})
        if totalPages && totalPages > 1
          span.text-muted Page #{currentPage} of #{totalPages}

      .products-grid
        each p in products
          .product
            .product-media
              if p.image && p.image.length > 0
                img(src=imageUrl(p.image), alt=p.name)
              else
                span.no-image üì¶
              
              if p.category
                span.badge= p.category

            .product-body
              h3= p.name
              p.price $#{Number(p.price || 0).toFixed(2)}
              if p.stock
                p.text-muted(style="font-size: 0.85rem;") Stock: #{p.stock}
              .product-actions
                a.btn.btn-outline(href=`/product/${p._id}`) View Details
                if !user || user.role !== 'admin'
                  form(action="/cart/add" method="POST" style="margin: 0;")
                    input(type="hidden" name="productId" value=p._id)
                    button.btn(type="submit" style="width: 100%;") üõí Add

  if totalPages && totalPages > 1
    .container
      .pagination-bar
        span.text-muted Page #{currentPage} of #{totalPages}
        .pagination-links
          if currentPage > 1
            a.btn.btn-outline(href=`/shop?page=${currentPage-1}&category=${selectedCategory||''}&minPrice=${minPrice||''}&maxPrice=${maxPrice||''}`) ‚Üê Previous
          if currentPage < totalPages
            a.btn(href=`/shop?page=${currentPage+1}&category=${selectedCategory||''}&minPrice=${minPrice||''}&maxPrice=${maxPrice||''}`) Next ‚Üí
